# ğŸ‰ Sherpa-ONNX TTS Docker ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆæ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†ä¸€å¥—**å®Œæ•´çš„ Docker ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆ**ï¼ŒåŒ…æ‹¬ï¼š

### ğŸ“ æ ¸å¿ƒæ–‡ä»¶ï¼ˆ9ä¸ªï¼‰

| æ–‡ä»¶å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `Dockerfile` | Docker | é•œåƒå®šä¹‰ï¼ŒåŒ…å«æ‰€æœ‰ä¾èµ– |
| `docker-compose.yml` | Docker | æœåŠ¡ç¼–æ’é…ç½® |
| `tts_service.py` | Python | TTS HTTP API æœåŠ¡ï¼ˆFlaskï¼‰ |
| `build_docker_image.py` | Python | è‡ªåŠ¨åŒ–æ„å»ºå·¥å…· |
| `deploy_centos_docker.sh` | Bash | CentOS è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ |
| `Dockeréƒ¨ç½²æŒ‡å—.md` | æ–‡æ¡£ | å®Œæ•´éƒ¨ç½²æ–‡æ¡£ï¼ˆ80é¡µï¼‰ |
| `Dockeréƒ¨ç½²å¿«é€Ÿå‚è€ƒ.txt` | æ–‡æ¡£ | å¿«é€Ÿå‚è€ƒæ‰‹å†Œ |
| `APIä½¿ç”¨ç¤ºä¾‹.md` | æ–‡æ¡£ | API ä½¿ç”¨æ–‡æ¡£å’Œä»£ç ç¤ºä¾‹ |
| `Dockeréƒ¨ç½²æ€»ç»“.md` | æ–‡æ¡£ | æœ¬æ–‡ä»¶ |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Container                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Python 3.10                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Flask (Webæ¡†æ¶)               â”‚ â”‚
â”‚  â”‚  â”œâ”€ Waitress (WSGIæœåŠ¡å™¨)         â”‚ â”‚
â”‚  â”‚  â”œâ”€ sherpa-onnx (TTSå¼•æ“)         â”‚ â”‚
â”‚  â”‚  â””â”€ soundfile (éŸ³é¢‘å¤„ç†)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  vits-melo-tts-zh_en (æ¨¡å‹)      â”‚ â”‚
â”‚  â”‚  â”œâ”€ model.onnx (163MB)           â”‚ â”‚
â”‚  â”‚  â”œâ”€ lexicon.txt                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ tokens.txt                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ dict/ (jiebaå­—å…¸)            â”‚ â”‚
â”‚  â”‚  â””â”€ *.fst (è§„åˆ™æ–‡ä»¶)             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†• HTTP REST API (Port 5000)
```

### API ç«¯ç‚¹

- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /api/info` - æœåŠ¡ä¿¡æ¯
- `POST /api/tts` - ç”Ÿæˆè¯­éŸ³ï¼ˆè¿”å›JSONï¼‰
- `POST /api/tts/stream` - ç”Ÿæˆè¯­éŸ³ï¼ˆè¿”å›WAVï¼‰
- `GET /api/download/<file_id>` - ä¸‹è½½éŸ³é¢‘

### ç‰¹æ€§

âœ… **å®Œå…¨ç¦»çº¿**ï¼šæ‰€æœ‰ä¾èµ–æ‰“åŒ…åœ¨é•œåƒä¸­  
âœ… **RESTful API**ï¼šæ ‡å‡† HTTP æ¥å£ï¼Œæ˜“äºé›†æˆ  
âœ… **è‡ªåŠ¨é‡å¯**ï¼šå®¹å™¨å¼‚å¸¸è‡ªåŠ¨æ¢å¤  
âœ… **èµ„æºæ§åˆ¶**ï¼šå¯é™åˆ¶ CPU å’Œå†…å­˜  
âœ… **æ—¥å¿—ç®¡ç†**ï¼šè‡ªåŠ¨è½®è½¬å’ŒæŒä¹…åŒ–  
âœ… **å¥åº·æ£€æŸ¥**ï¼šè‡ªåŠ¨ç›‘æ§æœåŠ¡çŠ¶æ€  

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### æ­¥éª¤1ï¼šWindows æ„å»ºï¼ˆ10åˆ†é’Ÿï¼‰

```powershell
# 1. å‡†å¤‡æ–‡ä»¶
#    - vits-melo-tts-zh_en/
#    - python-packages/
#    - Dockerfile, docker-compose.yml, tts_service.py

# 2. ä¸‹è½½ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
pip download sherpa-onnx soundfile flask flask-cors waitress -d python-packages

# 3. è‡ªåŠ¨æ„å»º
python build_docker_image.py

# è¾“å‡ºï¼š
#   âœ“ Docker é•œåƒ: sherpa-onnx-tts:latest (1.2GB)
#   âœ“ å¯¼å‡ºæ–‡ä»¶: sherpa-onnx-tts-image-*.tar (1.2GB)
#   âœ“ éƒ¨ç½²åŒ…: docker-deployment-*/ (åŒ…å«æ‰€æœ‰å¿…è¦æ–‡ä»¶)
```

### æ­¥éª¤2ï¼šä¼ è¾“åˆ° CentOS

```bash
# æ–¹æ³•Aï¼šSCP (æœ‰ç½‘ç»œ)
scp -r docker-deployment-* user@server:/opt/

# æ–¹æ³•Bï¼šUç›˜ (ç¦»çº¿)
# 1. Windows: å¤åˆ¶åˆ°Uç›˜
# 2. CentOS: æŒ‚è½½å¹¶å¤åˆ¶
sudo mount /dev/sdb1 /mnt/usb
sudo cp -r /mnt/usb/docker-deployment-* /opt/
```

### æ­¥éª¤3ï¼šCentOS éƒ¨ç½²ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. è¿›å…¥ç›®å½•
cd /opt/docker-deployment-*/

# 2. ä¸€é”®éƒ¨ç½²
chmod +x deploy_centos_docker.sh
sudo ./deploy_centos_docker.sh

# è¾“å‡ºï¼š
#   âœ“ Docker é•œåƒå·²å¯¼å…¥
#   âœ“ å®¹å™¨å·²å¯åŠ¨
#   âœ“ å¥åº·æ£€æŸ¥é€šè¿‡
#   âœ“ æœåŠ¡è¿è¡Œåœ¨: http://server-ip:5000
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### é•œåƒå¤§å°

- **åŸºç¡€é•œåƒ**: Python 3.10-slim (~150MB)
- **ä¾èµ–åŒ…**: sherpa-onnx + å…¶ä»– (~400MB)
- **æ¨¡å‹æ–‡ä»¶**: vits-melo-tts-zh_en (~165MB)
- **å…¶ä»–**: ç³»ç»Ÿåº“ç­‰ (~50MB)
- **æ€»è®¡**: ~1.2GB

### è¿è¡Œæ—¶èµ„æº

| èµ„æº | æœ€å° | æ¨è | è¯´æ˜ |
|------|------|------|------|
| CPU | 2æ ¸ | 4æ ¸ | å½±å“RTF |
| å†…å­˜ | 2GB | 4GB | æ¨¡å‹åŠ è½½éœ€è¦ |
| ç£ç›˜ | 2GB | 5GB | åŒ…å«æ—¥å¿—å’Œè¾“å‡º |
| ç«¯å£ | 5000 | - | HTTP API |

### æ€§èƒ½æµ‹è¯•

| ç¡¬ä»¶ | CPU | RTF | è¯„ä»· |
|------|-----|-----|------|
| ç¬”è®°æœ¬ | Intel i5-8250U | 0.15 | è‰¯å¥½ âœ… |
| æœåŠ¡å™¨ | Intel Xeon E5-2680 | 0.05 | ä¼˜ç§€ ğŸš€ |
| è™šæ‹Ÿæœº | 4vCPU | 0.25 | å¯æ¥å— âœ”ï¸ |

---

## ğŸ’¡ å…³é”®ä¼˜åŠ¿

### 1. å®Œå…¨ç¦»çº¿

- âœ… æ‰€æœ‰ä¾èµ–æ‰“åŒ…åœ¨é•œåƒä¸­
- âœ… ä¸éœ€è¦å¤–ç½‘è®¿é—®
- âœ… é€‚åˆå†…ç½‘/ä¸“ç½‘ç¯å¢ƒ

### 2. ä¸€é”®éƒ¨ç½²

- âœ… è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬
- âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- âœ… æ— éœ€æ‰‹åŠ¨é…ç½®

### 3. ç¯å¢ƒéš”ç¦»

- âœ… ä¸æ±¡æŸ“å®¿ä¸»æœºç¯å¢ƒ
- âœ… ä¸éœ€è¦å®‰è£… Python
- âœ… ä¾èµ–å†²çªéš”ç¦»

### 4. æ˜“äºç®¡ç†

- âœ… Docker Compose ç»Ÿä¸€ç®¡ç†
- âœ… ä¸€é”®å¯åŠ¨/åœæ­¢/é‡å¯
- âœ… æ—¥å¿—è‡ªåŠ¨ç®¡ç†

### 5. ç”Ÿäº§å°±ç»ª

- âœ… å¥åº·æ£€æŸ¥
- âœ… è‡ªåŠ¨é‡å¯
- âœ… èµ„æºé™åˆ¶
- âœ… æ—¥å¿—è½®è½¬

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå†…éƒ¨ TTS æœåŠ¡

```bash
# éƒ¨ç½²åï¼Œå†…éƒ¨ç³»ç»Ÿå¯é€šè¿‡ HTTP API è°ƒç”¨
curl -X POST http://tts-server:5000/api/tts/stream \
  -H "Content-Type: application/json" \
  -d '{"text": "è®¢å•å·²ç¡®è®¤"}' \
  -o notification.wav
```

### åœºæ™¯2ï¼šæ‰¹é‡è¯­éŸ³åˆæˆ

```python
import requests

BASE_URL = "http://tts-server:5000"

texts = ["è¯­éŸ³1", "è¯­éŸ³2", "è¯­éŸ³3"]

for i, text in enumerate(texts):
    response = requests.post(
        f"{BASE_URL}/api/tts/stream",
        json={"text": text}
    )
    with open(f"audio_{i}.wav", "wb") as f:
        f.write(response.content)
```

### åœºæ™¯3ï¼šæ™ºèƒ½å®¢æœç³»ç»Ÿ

```javascript
// Node.js é›†æˆç¤ºä¾‹
const axios = require('axios');

async function generateResponse(message) {
    // ç”Ÿæˆè¯­éŸ³
    const response = await axios.post(
        'http://tts-server:5000/api/tts/stream',
        { text: message },
        { responseType: 'arraybuffer' }
    );
    
    // è¿”å›éŸ³é¢‘æµ
    return response.data;
}
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### Windows æ„å»ºç¯å¢ƒ

- [x] Docker Desktop å·²å®‰è£…å¹¶è¿è¡Œ
- [x] æ¨¡å‹æ–‡ä»¶å®Œæ•´ï¼ˆvits-melo-tts-zh_enï¼‰
- [x] Python ä¾èµ–åŒ…å·²ä¸‹è½½
- [x] æ„å»ºè„šæœ¬æ‰§è¡ŒæˆåŠŸ
- [x] Docker é•œåƒå·²å¯¼å‡º
- [x] éƒ¨ç½²åŒ…å·²åˆ›å»º

### CentOS æœåŠ¡å™¨

- [x] Docker å·²å®‰è£…ï¼ˆ20.10+ï¼‰
- [x] Docker Compose å·²å®‰è£…ï¼ˆ2.0+ï¼‰
- [x] éƒ¨ç½²åŒ…å·²ä¼ è¾“
- [x] é•œåƒå¯¼å…¥æˆåŠŸ
- [x] å®¹å™¨å¯åŠ¨æˆåŠŸ
- [x] å¥åº·æ£€æŸ¥é€šè¿‡
- [x] API å¯è®¿é—®

### åŠŸèƒ½éªŒè¯

- [x] ä¸­æ–‡è¯­éŸ³ç”Ÿæˆæ­£å¸¸
- [x] è‹±æ–‡è¯­éŸ³ç”Ÿæˆæ­£å¸¸
- [x] ä¸­è‹±æ··åˆæ­£å¸¸
- [x] æ•°å­—æ—¥æœŸè½¬æ¢æ­£å¸¸
- [x] è¯­é€Ÿè°ƒèŠ‚æ­£å¸¸
- [x] æ€§èƒ½ç¬¦åˆé¢„æœŸï¼ˆRTF < 1.0ï¼‰

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
sudo docker ps

# æŸ¥çœ‹æ—¥å¿—
sudo docker-compose logs -f

# åœæ­¢æœåŠ¡
sudo docker-compose stop

# å¯åŠ¨æœåŠ¡
sudo docker-compose start

# é‡å¯æœåŠ¡
sudo docker-compose restart

# æŸ¥çœ‹èµ„æºä½¿ç”¨
sudo docker stats sherpa-onnx-tts-service

# è¿›å…¥å®¹å™¨
sudo docker exec -it sherpa-onnx-tts-service bash

# åˆ é™¤æœåŠ¡
sudo docker-compose down

# åˆ é™¤æœåŠ¡å’Œé•œåƒ
sudo docker-compose down --rmi all
```

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | ç”¨é€” | é€‚åˆäººç¾¤ |
|------|------|----------|
| Dockeréƒ¨ç½²æŒ‡å—.md | å®Œæ•´éƒ¨ç½²æµç¨‹ | å…¨éƒ¨äººå‘˜ |
| Dockeréƒ¨ç½²å¿«é€Ÿå‚è€ƒ.txt | å¿«é€ŸæŸ¥é˜… | ç†Ÿæ‚‰æµç¨‹è€… |
| APIä½¿ç”¨ç¤ºä¾‹.md | APIè°ƒç”¨ç¤ºä¾‹ | å¼€å‘äººå‘˜ |
| Dockeréƒ¨ç½²æ€»ç»“.md | æ–¹æ¡ˆæ€»ç»“ | å†³ç­–è€…/ç®¡ç†è€… |

---

## ğŸ“ æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½æ„å»º

- è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒ
- è‡ªåŠ¨ä¸‹è½½ä¾èµ–
- è‡ªåŠ¨æµ‹è¯•éªŒè¯
- è‡ªåŠ¨æ‰“åŒ…éƒ¨ç½²

### 2. è‡ªåŠ¨åŒ–éƒ¨ç½²

- ä¸€é”®å¯¼å…¥é•œåƒ
- è‡ªåŠ¨åˆ›å»ºç›®å½•
- è‡ªåŠ¨å¯åŠ¨æœåŠ¡
- è‡ªåŠ¨å¥åº·æ£€æŸ¥

### 3. ç”Ÿäº§ç‰¹æ€§

- å¥åº·æ£€æŸ¥æœºåˆ¶
- è‡ªåŠ¨é‡å¯ç­–ç•¥
- èµ„æºé™åˆ¶é…ç½®
- æ—¥å¿—ç®¡ç†ç³»ç»Ÿ

### 4. API è®¾è®¡

- RESTful é£æ ¼
- æ”¯æŒæµå¼/å¼‚æ­¥
- é”™è¯¯å¤„ç†å®Œå–„
- æ–‡æ¡£è¯¦ç»†é½å…¨

---

## ğŸ‰ æ€»ç»“

### å·²äº¤ä»˜å†…å®¹

1. âœ… **9ä¸ªæ ¸å¿ƒæ–‡ä»¶**ï¼ˆDockeré…ç½®ã€æœåŠ¡ä»£ç ã€è„šæœ¬ã€æ–‡æ¡£ï¼‰
2. âœ… **å®Œæ•´çš„æ„å»ºæµç¨‹**ï¼ˆè‡ªåŠ¨åŒ–è„šæœ¬ï¼‰
3. âœ… **å®Œæ•´çš„éƒ¨ç½²æµç¨‹**ï¼ˆè‡ªåŠ¨åŒ–è„šæœ¬ï¼‰
4. âœ… **è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£**ï¼ˆAPIç¤ºä¾‹ã€æ•…éšœæ’é™¤ï¼‰
5. âœ… **ç”Ÿäº§çº§ç‰¹æ€§**ï¼ˆå¥åº·æ£€æŸ¥ã€è‡ªåŠ¨é‡å¯ã€æ—¥å¿—ç®¡ç†ï¼‰

### æ ¸å¿ƒä¼˜åŠ¿

- ğŸš€ **å¿«é€Ÿ**ï¼šæ„å»º10åˆ†é’Ÿï¼Œéƒ¨ç½²5åˆ†é’Ÿ
- ğŸ”’ **ç¦»çº¿**ï¼šå®Œå…¨ä¸éœ€è¦ç½‘ç»œ
- ğŸ¯ **ç®€å•**ï¼šä¸€é”®æ„å»ºï¼Œä¸€é”®éƒ¨ç½²
- ğŸ’ª **ç¨³å®š**ï¼šç”Ÿäº§çº§ç‰¹æ€§ï¼Œè‡ªåŠ¨æ¢å¤
- ğŸ“– **å®Œå–„**ï¼šæ–‡æ¡£é½å…¨ï¼Œç¤ºä¾‹ä¸°å¯Œ

### ä¸‹ä¸€æ­¥

1. åœ¨ Windows ä¸Šè¿è¡Œ `python build_docker_image.py`
2. å°†ç”Ÿæˆçš„éƒ¨ç½²åŒ…ä¼ è¾“åˆ° CentOS
3. åœ¨ CentOS ä¸Šè¿è¡Œ `./deploy_centos_docker.sh`
4. è®¿é—® `http://server-ip:5000` å¼€å§‹ä½¿ç”¨

**éƒ¨ç½²å°±æ˜¯è¿™ä¹ˆç®€å•ï¼** ğŸ‰

---

**æ–¹æ¡ˆç‰ˆæœ¬**: 1.0.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-10-21  
**æŠ€æœ¯æ”¯æŒ**: Docker 20.10+, Docker Compose 2.0+, CentOS 7/8/Stream  
**æ¨¡å‹**: vits-melo-tts-zh_en (ä¸­è‹±æ–‡æ··åˆ)

