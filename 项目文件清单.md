# 📋 Sherpa-ONNX TTS 部署项目文件清单

## 📁 生成的文件列表

本项目已为您生成以下文件，用于完成 vits-melo-tts-zh_en 模型的本地部署和离线打包：

### 📖 文档文件

| 文件名 | 描述 | 用途 |
|--------|------|------|
| `部署指南.md` | 完整的部署指南（80页） | 详细的分步部署说明，包含Windows和CentOS两种环境 |
| `快速开始指南.md` | 快速入门指南 | 5分钟快速上手指南，适合快速部署 |
| `项目文件清单.md` | 本文件 | 项目文件说明和使用流程 |

### 🐍 Python 脚本

| 文件名 | 描述 | 用途 |
|--------|------|------|
| `test_tts.py` | TTS 测试脚本 | 测试模型功能，生成示例音频 |
| `download_model.py` | 模型下载脚本 | 自动下载 vits-melo-tts-zh_en 模型 |
| `create_offline_package.py` | 离线打包工具 | 制作完整的离线部署包 |

### 🔧 部署脚本

| 文件名 | 描述 | 用途 |
|--------|------|------|
| `deploy_windows.bat` | Windows 自动部署脚本 | Windows 环境一键部署 |
| `deploy_centos.sh` | CentOS 自动部署脚本 | CentOS 环境一键部署 |

---

## 🚀 使用流程

### 第一阶段：Windows 本地测试

#### 步骤 1：安装 Python 环境

```powershell
# 1. 下载并安装 Python 3.8+
#    https://www.python.org/downloads/

# 2. 验证安装
python --version
```

#### 步骤 2：下载模型

```powershell
# 方法1：使用自动下载脚本（推荐）
python download_model.py

# 方法2：手动下载
# 访问: https://github.com/k2-fsa/sherpa-onnx/releases/download/tts-models/vits-melo-tts-zh_en.tar.bz2
# 下载后解压到当前目录
```

#### 步骤 3：安装依赖并测试

```powershell
# 在线安装（如果有网络）
pip install sherpa-onnx soundfile

# 运行测试
python test_tts.py
```

**预期结果**：生成 5 个 WAV 音频文件（test_chinese.wav, test_english.wav 等）

---

### 第二阶段：制作离线部署包

#### 步骤 4：创建离线部署包

```powershell
# 运行打包工具
python create_offline_package.py
```

**打包工具会自动**：
1. ✅ 下载所有 Python 依赖包
2. ✅ 复制模型文件
3. ✅ 复制所有脚本和文档
4. ✅ 生成 README 文件
5. ✅ 打包成 .tar.bz2 或 .zip 格式

**生成的部署包结构**：
```
tts-deploy-package/
├── models/
│   └── vits-melo-tts-zh_en/       # 模型文件（163 MB）
│       ├── model.onnx
│       ├── lexicon.txt
│       └── tokens.txt
├── python-packages/                # Python 离线安装包
│   ├── sherpa_onnx-1.x.x-py3-none-win_amd64.whl
│   ├── soundfile-x.x.x-py3-none-any.whl
│   └── ... (所有依赖包)
├── scripts/
│   ├── test_tts.py                # 测试脚本
│   └── download_model.py          # 模型下载脚本
├── deploy_windows.bat             # Windows 部署脚本
├── deploy_centos.sh               # CentOS 部署脚本
├── 部署指南.md                     # 详细文档
├── 快速开始指南.md                 # 快速指南
└── README.md                      # 部署包说明
```

---

### 第三阶段：CentOS 服务器部署

#### 步骤 5：传输部署包

```bash
# 方法1：使用 scp（如果有网络连接）
scp tts-deploy-package-20241021_*.tar.bz2 user@server:/opt/

# 方法2：使用物理介质（U盘、移动硬盘等）
#   1. 复制压缩包到 U盘
#   2. 在服务器上挂载 U盘
#   3. 复制文件到 /opt/
```

#### 步骤 6：在 CentOS 上部署

```bash
# 1. 解压部署包
cd /opt
tar -xjf tts-deploy-package-20241021_*.tar.bz2
cd tts-deploy-package

# 2. 运行自动部署脚本
chmod +x deploy_centos.sh
./deploy_centos.sh
```

**自动部署脚本会**：
1. ✅ 检查 Python 环境
2. ✅ 安装系统依赖（gcc, make 等）
3. ✅ 创建 Python 虚拟环境
4. ✅ 离线安装 Python 包
5. ✅ 运行测试验证部署

#### 步骤 7：验证部署

```bash
# 查看生成的音频文件
ls -lh scripts/*.wav

# 如果有音频设备，可以播放测试
aplay scripts/test_chinese.wav
```

---

## 📊 部署检查清单

### ✅ Windows 环境检查

- [ ] Python 3.8+ 已安装
- [ ] pip 可用
- [ ] 模型已下载（vits-melo-tts-zh_en 目录存在）
- [ ] sherpa-onnx 已安装
- [ ] soundfile 已安装
- [ ] 测试脚本运行成功
- [ ] 生成了示例音频文件

### ✅ 离线部署包检查

- [ ] 部署包已创建
- [ ] python-packages 目录包含所有依赖
- [ ] models 目录包含完整模型文件
- [ ] 所有脚本和文档都已包含
- [ ] 压缩包大小合理（约 200-300 MB）

### ✅ CentOS 部署检查

- [ ] 部署包已传输到服务器
- [ ] Python 3.8+ 已安装
- [ ] 系统依赖已安装（gcc, make 等）
- [ ] 虚拟环境已创建
- [ ] Python 包离线安装成功
- [ ] 测试脚本运行成功
- [ ] 生成了示例音频文件

---

## 🔍 常见问题速查

### Q1: 找不到模型文件

```bash
# 解决方案：重新下载模型
python download_model.py
```

### Q2: 导入 sherpa_onnx 失败

```bash
# 解决方案：重新安装
pip install --no-index --find-links=python-packages sherpa-onnx
```

### Q3: CentOS 编译错误

```bash
# 解决方案：安装编译工具
sudo yum install -y gcc gcc-c++ make python3-devel
```

### Q4: 生成速度慢（RTF > 1.0）

```python
# 解决方案：增加线程数
config = sherpa_onnx.OfflineTtsConfig(
    model=sherpa_onnx.OfflineTtsModelConfig(
        num_threads=8,  # 增加线程数
    )
)
```

---

## 📞 技术支持

### 官方资源

- **官方文档**: https://k2-fsa.github.io/sherpa/onnx/tts/pretrained_models/vits.html
- **GitHub**: https://github.com/k2-fsa/sherpa-onnx
- **模型下载**: https://github.com/k2-fsa/sherpa-onnx/releases/tag/tts-models
- **在线演示**: https://huggingface.co/spaces/k2-fsa/text-to-speech

### 本地文档

- **详细部署**: 查看 `部署指南.md`
- **快速开始**: 查看 `快速开始指南.md`

---

## 🎯 下一步建议

1. **完成本地测试**
   - 运行 `python test_tts.py`
   - 检查生成的音频质量
   - 调整参数优化性能

2. **制作部署包**
   - 运行 `python create_offline_package.py`
   - 验证部署包完整性
   - 传输到目标服务器

3. **服务器部署**
   - 解压部署包
   - 运行 `./deploy_centos.sh`
   - 验证部署结果

4. **集成到应用**
   - 参考 Python API 示例
   - 实现自己的业务逻辑
   - 添加错误处理和日志

---

## 📝 注意事项

### ⚠️ 重要提醒

1. **模型文件必须完整**
   - model.onnx（约 163 MB）
   - lexicon.txt（约 2 MB）
   - tokens.txt（约 50 KB）

2. **Python 版本要求**
   - 最低: Python 3.8
   - 推荐: Python 3.9 或 3.10
   - 注意: Python 3.12 可能有兼容性问题

3. **系统依赖**
   - Windows: 需要 Visual C++ Redistributable
   - CentOS: 需要 gcc, make, python3-devel

4. **性能优化**
   - 根据 CPU 核心数调整线程数
   - 避免一次合成过长文本
   - 首次加载会较慢，后续会快

5. **离线环境注意**
   - 确保下载了所有依赖包
   - 模型文件完整且未损坏
   - 系统依赖预先安装

---

## 🎉 完成标志

当您看到以下输出时，表示部署成功：

```
============================================================
✅ 所有测试完成！
============================================================
成功生成: 5/5 个音频文件
总音频时长: 15.23秒
总生成耗时: 2.34秒
平均 RTF: 0.154
性能评估: 良好 ✅
```

**恭喜！您已成功完成 Sherpa-ONNX TTS 模型的部署！** 🎊

---

**文档版本**: 1.0.0  
**最后更新**: 2024-10-21  
**适用模型**: vits-melo-tts-zh_en

