# ğŸš€ Sherpa-ONNX TTS å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“Œ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ **5åˆ†é’Ÿå†…** å®Œæˆ sherpa-onnx TTS æ¨¡å‹çš„éƒ¨ç½²å’Œæµ‹è¯•ã€‚

## âš ï¸ é‡è¦æç¤º

**vits-melo-tts-zh_en æ¨¡å‹å…¼å®¹æ€§é—®é¢˜**ï¼š
- è¯¥æ¨¡å‹åœ¨æŸäº› sherpa-onnx ç‰ˆæœ¬ä¸­å¯èƒ½å‡ºç° `vits-dict-dir` é”™è¯¯
- å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ `æ•…éšœæ’é™¤æŒ‡å—.md`
- æ¨èä½¿ç”¨æ›¿ä»£æ¨¡å‹ï¼ˆè§ä¸‹æ–¹ï¼‰æˆ–å‡çº§ sherpa-onnx åˆ°æœ€æ–°ç‰ˆæœ¬

**æ¨èçš„æ›¿ä»£æ¨¡å‹**ï¼š
- è‹±æ–‡ï¼š`vits-piper-en_GB-cori-medium`
- ä¸­æ–‡ï¼š`vits-icefall-zh-aishell3`
- æµ‹è¯•å·¥å…·ï¼š`python test_tts_alternative.py`

---

## ğŸªŸ Windows å¿«é€Ÿå¼€å§‹

### å‡†å¤‡å·¥ä½œï¼ˆä¸€æ¬¡æ€§ï¼‰

1. **å®‰è£… Python 3.8+**
   - ä¸‹è½½åœ°å€ï¼šhttps://www.python.org/downloads/
   - å®‰è£…æ—¶å‹¾é€‰ "Add Python to PATH"

2. **éªŒè¯ Python å®‰è£…**
   ```powershell
   python --version
   ```
   åº”è¯¥æ˜¾ç¤º Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬

### æ–¹æ¡ˆAï¼šåœ¨çº¿å®‰è£…ï¼ˆé€‚åˆæœ‰ç½‘ç»œçš„ç¯å¢ƒï¼‰

```powershell
# 1. å®‰è£… sherpa-onnx
pip install sherpa-onnx soundfile

# 2. ä¸‹è½½æ¨¡å‹
python download_model.py

# 3. è¿è¡Œæµ‹è¯•
python test_tts.py
```

**å®Œæˆï¼** æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç”Ÿæˆäº†å‡ ä¸ª `.wav` éŸ³é¢‘æ–‡ä»¶ã€‚

### æ–¹æ¡ˆBï¼šç¦»çº¿éƒ¨ç½²ï¼ˆé€‚åˆæ— ç½‘ç»œæˆ–éœ€è¦æ‰“åŒ…ï¼‰

```powershell
# 1. åˆ›å»ºå·¥ä½œç›®å½•
mkdir D:\tts-deploy
cd D:\tts-deploy

# 2. ä¸‹è½½ä¾èµ–åŒ…ï¼ˆåœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šï¼‰
pip download sherpa-onnx soundfile -d packages

# 3. ä¸‹è½½æ¨¡å‹ï¼ˆåœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šï¼‰
python download_model.py

# 4. æ‰“åŒ…æ•´ä¸ªç›®å½•
#    - å¤åˆ¶åˆ°ç›®æ ‡æœºå™¨
#    - åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œï¼š

# 5. ç¦»çº¿å®‰è£…ä¾èµ–
pip install --no-index --find-links=packages sherpa-onnx soundfile

# 6. è¿è¡Œæµ‹è¯•
python test_tts.py
```

---

## ğŸ§ Linux/CentOS å¿«é€Ÿå¼€å§‹

### å‡†å¤‡å·¥ä½œï¼ˆä¸€æ¬¡æ€§ï¼‰

```bash
# CentOS 7
sudo yum install -y python3 python3-devel gcc gcc-c++ make

# CentOS 8/Stream
sudo dnf install -y python3 python3-devel gcc gcc-c++ make
```

### åœ¨çº¿å®‰è£…

```bash
# 1. å®‰è£… sherpa-onnx
pip3 install sherpa-onnx soundfile

# 2. ä¸‹è½½æ¨¡å‹
python3 download_model.py

# 3. è¿è¡Œæµ‹è¯•
python3 test_tts.py
```

### ç¦»çº¿éƒ¨ç½²

```bash
# 1. è§£å‹éƒ¨ç½²åŒ…
tar -xjf tts-deploy-package.tar.bz2
cd tts-deploy-package

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
chmod +x deploy_centos.sh
./deploy_centos.sh
```

---

## ğŸ¯ åŸºç¡€ä½¿ç”¨ç¤ºä¾‹

### Python ä»£ç ç¤ºä¾‹

```python
import sherpa_onnx
import soundfile as sf

# 1. é…ç½®æ¨¡å‹
config = sherpa_onnx.OfflineTtsConfig(
    model=sherpa_onnx.OfflineTtsModelConfig(
        vits=sherpa_onnx.OfflineTtsVitsModelConfig(
            model="./vits-melo-tts-zh_en/model.onnx",
            lexicon="./vits-melo-tts-zh_en/lexicon.txt",
            tokens="./vits-melo-tts-zh_en/tokens.txt",
        ),
        num_threads=4,
        provider="cpu",
    ),
)

# 2. åˆ›å»º TTS å¯¹è±¡
tts = sherpa_onnx.OfflineTts(config)

# 3. ç”Ÿæˆè¯­éŸ³
text = "ä½ å¥½ä¸–ç•Œï¼ŒHello Worldï¼"
audio = tts.generate(text, sid=0, speed=1.0)

# 4. ä¿å­˜éŸ³é¢‘
sf.write("output.wav", audio.samples, samplerate=audio.sample_rate)

print("âœ… éŸ³é¢‘å·²ä¿å­˜åˆ° output.wav")
```

### å‘½ä»¤è¡Œä½¿ç”¨ï¼ˆå¦‚æœå·²ç¼–è¯‘ C++ ç‰ˆæœ¬ï¼‰

```bash
# ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·
sherpa-onnx-offline-tts \
  --vits-model=./vits-melo-tts-zh_en/model.onnx \
  --vits-lexicon=./vits-melo-tts-zh_en/lexicon.txt \
  --vits-tokens=./vits-melo-tts-zh_en/tokens.txt \
  --output-filename=output.wav \
  "ä½ å¥½ä¸–ç•Œ"
```

---

## ğŸ“ å¸¸ç”¨å‚æ•°è¯´æ˜

### è¯­é€Ÿæ§åˆ¶

```python
# æ­£å¸¸é€Ÿåº¦
audio = tts.generate(text, speed=1.0)

# åŠ å¿« 50%
audio = tts.generate(text, speed=1.5)

# å‡æ…¢ 20%
audio = tts.generate(text, speed=0.8)
```

### çº¿ç¨‹æ•°ä¼˜åŒ–

```python
# æ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´
config = sherpa_onnx.OfflineTtsConfig(
    model=sherpa_onnx.OfflineTtsModelConfig(
        vits=...,
        num_threads=4,  # æ¨èï¼šCPUæ ¸å¿ƒæ•°çš„ 50-80%
    ),
)
```

### éŸ³é¢‘è´¨é‡

```python
# ä¿å­˜ä¸º WAV æ ¼å¼ï¼ˆæœ€é«˜è´¨é‡ï¼‰
sf.write("output.wav", audio.samples, 
         samplerate=audio.sample_rate, 
         subtype="PCM_16")

# ä¿å­˜ä¸º FLAC æ ¼å¼ï¼ˆæ— æŸå‹ç¼©ï¼‰
sf.write("output.flac", audio.samples, 
         samplerate=audio.sample_rate)

# ä¿å­˜ä¸º OGG æ ¼å¼ï¼ˆæœ‰æŸå‹ç¼©ï¼Œæ–‡ä»¶å°ï¼‰
sf.write("output.ogg", audio.samples, 
         samplerate=audio.sample_rate)
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ°æ¨¡å‹æ–‡ä»¶

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ°æ¨¡å‹ç›®å½• 'vits-melo-tts-zh_en'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä¸‹è½½æ¨¡å‹
python download_model.py

# æˆ–æ‰‹åŠ¨ä¸‹è½½
# https://github.com/k2-fsa/sherpa-onnx/releases/download/tts-models/vits-melo-tts-zh_en.tar.bz2
```

### é—®é¢˜2ï¼šå¯¼å…¥ sherpa_onnx å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ModuleNotFoundError: No module named 'sherpa_onnx'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é‡æ–°å®‰è£…
pip install sherpa-onnx

# æˆ–ç¦»çº¿å®‰è£…
pip install --no-index --find-links=packages sherpa-onnx
```

### é—®é¢˜3ï¼šç”Ÿæˆé€Ÿåº¦æ…¢

**è¡¨ç°**ï¼šRTF > 1.0ï¼ˆå®æ—¶ç‡å¤§äº1ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¢åŠ çº¿ç¨‹æ•°ï¼š`num_threads=8`
2. å‡å°‘æ–‡æœ¬é•¿åº¦ï¼šæ¯æ¬¡åˆæˆä¸è¶…è¿‡ 500 å­—
3. ä½¿ç”¨æ›´å¿«çš„ CPU æˆ–å‡çº§ç¡¬ä»¶

### é—®é¢˜4ï¼šä¸­æ–‡å‘éŸ³ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `lexicon.txt` æ–‡ä»¶æ˜¯å¦å®Œæ•´
- å¯¹äºä¸“ä¸šæœ¯è¯­ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ°è¯å…¸
- å‚è€ƒï¼šhttps://github.com/k2-fsa/sherpa-onnx/pull/1209

---

## ğŸ“Š æ€§èƒ½å‚è€ƒ

| ç¡¬ä»¶ | CPU | çº¿ç¨‹ | RTF | è¯„ä»· |
|------|-----|------|-----|------|
| æ ‘è“æ´¾ 4 | Cortex-A72 | 4 | 0.16 | å¯ç”¨ âœ”ï¸ |
| ç¬”è®°æœ¬ | Intel i5 | 4 | 0.10 | è‰¯å¥½ âœ… |
| æœåŠ¡å™¨ | Intel Xeon | 8 | 0.05 | ä¼˜ç§€ ğŸš€ |

**RTF è¯´æ˜**ï¼š
- RTF < 0.3: ä¼˜ç§€ï¼Œå¯ä»¥æµå¼æ’­æ”¾
- RTF < 1.0: åˆæ ¼ï¼Œå¯ä»¥å®æ—¶åˆæˆ
- RTF > 1.0: è¾ƒæ…¢ï¼Œéœ€è¦ç­‰å¾…

---

## ğŸ“š è¿›é˜¶åŠŸèƒ½

### æ‰¹é‡åˆæˆ

```python
texts = [
    "ç¬¬ä¸€å¥è¯",
    "ç¬¬äºŒå¥è¯",
    "ç¬¬ä¸‰å¥è¯",
]

for i, text in enumerate(texts):
    audio = tts.generate(text)
    sf.write(f"output_{i}.wav", audio.samples, 
             samplerate=audio.sample_rate)
```

### å¤šçº¿ç¨‹å¹¶å‘

```python
from concurrent.futures import ThreadPoolExecutor

def generate_audio(text, filename):
    audio = tts.generate(text)
    sf.write(filename, audio.samples, samplerate=audio.sample_rate)
    return filename

texts_and_files = [
    ("æ–‡æœ¬1", "audio1.wav"),
    ("æ–‡æœ¬2", "audio2.wav"),
    ("æ–‡æœ¬3", "audio3.wav"),
]

with ThreadPoolExecutor(max_workers=3) as executor:
    futures = [executor.submit(generate_audio, text, file) 
               for text, file in texts_and_files]
    
    for future in futures:
        print(f"âœ… å®Œæˆ: {future.result()}")
```

### å®æ—¶æµå¼åˆæˆï¼ˆé«˜çº§ï¼‰

å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://k2-fsa.github.io/sherpa/onnx/tts/

---

## ğŸ”— ç›¸å…³èµ„æº

- **å®˜æ–¹æ–‡æ¡£**ï¼šhttps://k2-fsa.github.io/sherpa/onnx/tts/
- **GitHub ä»“åº“**ï¼šhttps://github.com/k2-fsa/sherpa-onnx
- **æ¨¡å‹ä¸‹è½½**ï¼šhttps://github.com/k2-fsa/sherpa-onnx/releases/tag/tts-models
- **åœ¨çº¿æ¼”ç¤º**ï¼šhttps://huggingface.co/spaces/k2-fsa/text-to-speech

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**ï¼šä» Python API å¼€å§‹ï¼Œæœ€ç®€å•æ˜“ç”¨
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šè€ƒè™‘ç¼–è¯‘ C++ ç‰ˆæœ¬ï¼Œæ€§èƒ½æ›´å¥½
3. **ç¦»çº¿éƒ¨ç½²**ï¼šæå‰ä¸‹è½½å¥½æ‰€æœ‰ä¾èµ–åŒ…å’Œæ¨¡å‹
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´çº¿ç¨‹æ•°
5. **é•¿æ–‡æœ¬**ï¼šåˆ†æ®µåˆæˆï¼Œé¿å…ä¸€æ¬¡åˆæˆè¿‡é•¿æ–‡æœ¬

---

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š
- [ ] Python 3.8+ å·²å®‰è£…
- [ ] pip å¯ç”¨
- [ ] æ¨¡å‹æ–‡ä»¶å·²ä¸‹è½½
- [ ] ä¾èµ–åŒ…å·²å®‰è£…

æµ‹è¯•å‰æ£€æŸ¥ï¼š
- [ ] æ¨¡å‹ç›®å½•å­˜åœ¨ä¸”åŒ…å« 3 ä¸ªæ–‡ä»¶ï¼ˆmodel.onnx, lexicon.txt, tokens.txtï¼‰
- [ ] sherpa_onnx å¯ä»¥æ­£å¸¸å¯¼å…¥
- [ ] soundfile å¯ä»¥æ­£å¸¸å¯¼å…¥

ç”Ÿäº§éƒ¨ç½²æ£€æŸ¥ï¼š
- [ ] æœåŠ¡å™¨æ»¡è¶³æœ€ä½é…ç½®è¦æ±‚ï¼ˆ2GB+ å†…å­˜ï¼‰
- [ ] æµ‹è¯•ç”¨ä¾‹å·²é€šè¿‡
- [ ] æ€§èƒ½æŒ‡æ ‡ç¬¦åˆé¢„æœŸï¼ˆRTF < 1.0ï¼‰
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶å·²å®Œå–„

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ `éƒ¨ç½²æŒ‡å—.md` æˆ–è®¿é—®å®˜æ–¹æ–‡æ¡£ã€‚

